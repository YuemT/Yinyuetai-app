<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title></title>
	<link rel="stylesheet" href="css/index.css" />
	<script type="text/javascript" src="js/transformCss.js"></script>
	<script type="text/javascript" src="js/Cdrag.js"></script>
</head>
<body>
<div id="wrap">
	<!--头部-->
	<div id="header">
		<!--登录注册-->
	     <div id="headerT">
	     	<h1 id="logo">
	     		<a href="javascript:;"><img src="img/logo.png" alt="" /></a>
	     	</h1>
	     	<a href="javascript:;" id="menuBtn" class="menuBtnClos"></a>
	     	<div id="nav">
		     	<a href="javascript:;" id="searchBtn">搜索</a>
		     	<a href="javascript:;">登录</a>
		     	<a href="javascript:;">注册</a>
	     	</div>	 
        </div> 
         <!--大搜索-->
        <div id="search">
             <input type="text" placeholder="请输入搜索内容" />
             <input type="submit" value="搜索" />
        </div>
     	<!--导航-->
		<ul id="mask">
     		<li><a href="javascript:;">首页</a></li>
			<li><a href="javascript:;">MV</a></li>
			<li><a href="javascript:;">悦单</a></li>
			<li><a href="javascript:;">V榜</a></li>
			<li><a href="javascript:;">音悦</a></li>
			<li><a href="javascript:;">商城</a></li>
			<li><a href="javascript:;">节目</a></li>
			<li><a href="javascript:;">饭团</a></li>
			<li><a href="javascript:;">资讯</a></li>
			<li><a href="javascript:;">我的家</a></li>	
       </ul>
	</div>
	<div id="C_wrap">	
		<!--内容区-->
		<div id="content">
			<!--导航-->
			<div id="navList">
				<ul id="navText">
	         		<li class="active"><a href="javascript:;">首页</a></li>
					<li><a href="javascript:;">MV</a></li>
					<li><a href="javascript:;">悦单</a></li>
					<li><a href="javascript:;">V榜</a></li>
					<li><a href="javascript:;">音悦</a></li>
					<li><a href="javascript:;">商城</a></li>
					<li><a href="javascript:;">节目</a></li>
					<li><a href="javascript:;">饭团</a></li>
					<li><a href="javascript:;">资讯</a></li>
					<li><a href="javascript:;">我的家</a></li>
	    		 	</ul>
			</div>
			<!--轮播图-->
			<div id="pic_wrap">
				<ul id="pic_list">
				<li><a href="javascript:;"><img src="img/1.jpg"/></a></li>
				<li><a href="javascript:;"><img src="img/2.jpg"/></a></li>
				<li><a href="javascript:;"><img src="img/3.jpg"/></a></li>
				<li><a href="javascript:;"><img src="img/4.jpg"/></a></li>
				<li><a href="javascript:;"><img src="img/5.jpg"/></a></li>
				</ul>
				<!--小圆点-->
				<div id="pic_nav">
				 	<span class="active"></span>
				 	<span></span>
				 	<span></span>
				 	<span></span>
				 	<span></span>
		 		</div> 
			 </div>
			 <!--tab -->
			<div class="tab">
				<!--大标题-->
				<header class="tab_h">
					<h2>MV首播</h2>
					<a href="javascript:;">更多&gt;</a>
				</header>
				<!--小导航-->
				<nav class="tab_nav">
					<a href="javascript:;">全部</a>
					<a href="javascript:;">内地</a>
					<a href="javascript:;">港台</a>
					<a href="javascript:;">欧美</a>
					<a href="javascript:;">韩国</a>
					<a href="javascript:;">日本</a>
					<!--小绿-->
					<span></span>
				</nav>
				<!--图片列表-->
				<div class="tab_wrap">
					<!--左侧加载区-->
					<ul class="tab_loading"></ul>
					<!--主体区域-->
					<ul class="tab_list">
						<li>
							<a href="javascript:;">
								<img src="img/a.jpg" alt="" />
								<span>内容描述内容描述内容描述内容描述内容描述内容描述内容描述内容描述</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/b.jpg" alt="" />
								<span>内容描述</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/c.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/d.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/e.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/f.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
					</ul>
					<!--右侧加载区-->
					<ul class="tab_loading"></ul>
				</div>
			</div>
			<div class="tab">
				<header class="tab_h">
					<h2>MV首播</h2>
					<a href="javascript:;">更多&gt;</a>
				</header>
				<nav class="tab_nav">
					<a href="javascript:;">全部</a>
					<a href="javascript:;">内地</a>
					<a href="javascript:;">港台</a>
					<a href="javascript:;">欧美</a>
					<a href="javascript:;">韩国</a>
					<a href="javascript:;">日本</a>
					<!--小绿-->
					<span></span>
				</nav>
				<!--图片列表-->
				<div class="tab_wrap">
					<ul class="tab_loading"></ul>
					<ul class="tab_list">
						<li>
							<a href="javascript:;">
								<img src="img/a.jpg" alt="" />
								<span>
									内容描述内容描述内容描述内容描述内容描述内容描述内容描述内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/b.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/c.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/d.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/e.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/f.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
					</ul>
					<ul class="tab_loading"></ul>
				</div>
			</div>
			<div class="tab">
				<header class="tab_h">
					<h2>MV首播</h2>
					<a href="javascript:;">更多&gt;</a>
				</header>
				<nav class="tab_nav">
					<a href="javascript:;">全部</a>
					<a href="javascript:;">内地</a>
					<a href="javascript:;">港台</a>
					<a href="javascript:;">欧美</a>
					<a href="javascript:;">韩国</a>
					<a href="javascript:;">日本</a>
					<!--小绿-->
					<span></span>
				</nav>
				<!--图片列表-->
				<div class="tab_wrap">
					<ul class="tab_loading"></ul>
					<ul class="tab_list">
						<li>
							<a href="javascript:;">
								<img src="img/a.jpg" alt="" />
								<span>
									内容描述内容描述内容描述内容描述内容描述内容描述内容描述内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/b.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/c.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/d.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/e.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/f.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
					</ul>
					<ul class="tab_loading"></ul>
				</div>
			</div>
			<div class="tab">
				<header class="tab_h">
					<h2>MV首播</h2>
					<a href="javascript:;">更多&gt;</a>
				</header>
				<nav class="tab_nav">
					<a href="javascript:;">全部</a>
					<a href="javascript:;">内地</a>
					<a href="javascript:;">港台</a>
					<a href="javascript:;">欧美</a>
					<a href="javascript:;">韩国</a>
					<a href="javascript:;">日本</a>
					<!--小绿-->
					<span></span>
				</nav>
				<!--图片列表-->
				<div class="tab_wrap">
					<ul class="tab_loading"></ul>
					<ul class="tab_list">
						<li>
							<a href="javascript:;">
								<img src="img/a.jpg" alt="" />
								<span>
									内容描述内容描述内容描述内容描述内容描述内容描述内容描述内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/b.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/c.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/d.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/e.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
						<li>
							<a href="javascript:;">
								<img src="img/f.jpg" alt="" />
								<span>
									内容描述
								</span>
								<!--ice-->
								<div class="ice">
									<!--左边--> 
									<a href="javascript:;" class="ice_left">
										<span class="ice_pic"></span>
										<span>9167</span>
									</a>
									<!--右边-->
									<a href="javascript:;" class="ice_right">
										<span class="ice_pic"></span>
										<span>6</span>
									</a>
									
								</div>
							</a>
						</li>
					</ul>
					<ul class="tab_loading"></ul>
				</div>
			</div>
		</div>
	</div>
	<!--滚动条-->
	<div id="scrollBar"></div>	
</div>
</body>
<script type="text/javascript">
	//取消默认行为
	document.addEventListener("touchstart",function(ev){
		ev.preventDefault();
	});
	
	//动态设置文档结构样式
	(function(){
		var width = document.documentElement.clientWidth/16;
		var styleN = document.createElement('style');
		styleN.innerHTML='html{font-size:'+ width +'px !important}';
		document.head.appendChild(styleN);
	})();
	
	//加载处理
	window.onload = function(){
	  	changeColor();
	  	drag();
	  	changeFocus();
	  	changeMenu();
	  	changeImg();
	  	tab();
	  	Cwrap();
	};
	
	//竖向滑屏
	function  Cwrap(){
		var Cwrap = document.getElementById('C_wrap');
		var content = document.getElementById('content');
		var scrollBar = document.getElementById('scrollBar');
		//比例：scale ＝ 屏幕高h／内容高H，
		//根据比例scale动态获取滚动条高度
		var scale = document.documentElement.clientHeight/content.offsetHeight;
		scrollBar.style.height = document.documentElement.clientHeight*scale +'px';
		//处理滚动条的显示与隐藏，默认隐藏
		//为callback对象添加属性，其属性对应函数用来设置滚动条的显示和隐藏
		//touchstart和touchmove时滚动条显示，touchend时滚动条隐藏
		//内容偏移量＝滚动条偏移量／scale;
		//touchmove时, 设置滚动条的位置
		var callback = {
			start:function(){
				scrollBar.style.opacity = '1';
			},
			move:function(){
				scrollBar.style.opacity = '1';
				var dis = transformCss(content,'translateY')*scale;
				transformCss(scrollBar,'translateY',-dis)
			},
			end:function(){
				scrollBar.style.opacity = '0';
			}	
		}
		Cdrag(Cwrap,callback);
	}
	
	//tab区域
	function tab(){
		var wrap = document.querySelectorAll('.tab_wrap');
		var nav = document.querySelectorAll('.tab_nav');
		var translateX = nav[0].offsetWidth;
		//获取对应的wrap，nav
		//for循环遍历所有的wrap，wrap和nav一一对应
		for(var i=0;i<wrap.length;i++){
			move(wrap[i],nav[i]);
		}
		
		function move(wrap,nav){
			transformCss(wrap,'translateZ',0.01);
			//把主体内容置回
			transformCss(wrap,'translateX',-translateX);
            //简单的拖拽
			var startX = 0;
			var eleX = 0;
			var startY = 0;
			var isFirst = true;
			var isX = true;
			var isLoad = false;
			var loadings = wrap.querySelectorAll('.tab_loading');
			//小绿条
			//nav.querySelectorAll 获取对应的和span
			var smallG = nav.querySelector('span');
			transformCss(smallG,'translateZ',0.01);
			//模拟a下标索引
			var now = 0;
			var aNodes = nav.querySelectorAll('a');

			//wrap的touchstart事件
			wrap.addEventListener('touchstart',function(ev){
				var touch = ev.changedTouches[0];
				//判断
				if(isLoad){
					return;
				}
				wrap.style.transition = 'none';
				startX = touch.clientX;
				eleX = transformCss(wrap,'translateX');
				startY = touch.clientY;
				//置回
				isFirst = true;
				isX = true;
			})
			
			//wrap的touchmove事件
			wrap.addEventListener('touchmove',function(ev){
				var touch = ev.changedTouches[0];
				//判断
				if(isLoad){
					return;
				}
				//防抖动处理
				if(!isX){
					return;
				}
				var nowX = touch.clientX;
				var disX = nowX - startX;
				var nowY = touch.clientY;
				var disY = nowY - startY;
				if(isFirst){
					isFirst =false;
					if(Math.abs(disY)>Math.abs(disX)){
						isX = false;
					}
				}
				transformCss(wrap,'translateX',eleX+disX);
				//判断手指滑过1/2，手指滑过1/2跳到loading图上
				if(Math.abs(disX)>translateX/2){
						//标识
						isLoad = true;
						//判断方向
						var target = disX > 0 ? 0 :-2*translateX;
						wrap.style.transition = '0.5s';
						transformCss(wrap,'translateX',target);
						//过渡彻底结束之后，loading图出来
						//兼容方式的处理
						wrap.addEventListener('transitionEnd',transitionEnd);
						wrap.addEventListener('webkitTransitionEnd',transitionEnd);
				};
				
			//监听过渡结束
			function transitionEnd(){
				//解绑
				wrap.removeEventListener('transitionEnd',transitionEnd);
				wrap.removeEventListener('webkitTransitionEnd',transitionEnd);
				//事件监听，过渡结束后loading图出来
				for(var i=0;i<loadings.length;i++){
					loadings[i].style.opacity = '1';
				}	
				// 处理小绿条
				if(disX < 0){
					now = now + 1;
				}else{
					now = now - 1;
				}
				//范围限定
				if(now < 0){
					now = aNodes.length-1;
				}else if(now > aNodes.length-1){
					now = 0;
				}
				//设置小绿条的过渡时间，和过渡的结束位置
				smallG.style.transition = '0.5s';
				transformCss(smallG,'translateX',aNodes[now].offsetLeft);
				//通过延时调用，将数据拿回来
				setTimeout(function(){
					wrap.style.transition = 'none';
					transformCss(wrap,'translateX',-translateX);
					//标记此时的isLoad为false
					isLoad = false;
					//遍历loading图，通过透明度设置其不显示
					for(var i=0;i<loadings.length;i++){
					loadings[i].style.opacity = '0';
					}
				},2000);
			}
		})
			
		wrap.addEventListener('touchend',function(ev){
			if(isLoad){
				return;
			}
			var touch = ev.changedTouches[0];
			var nowX = touch.clientX;
			var disX = nowX - startX;
			//设置touchend时小绿条的位置，小于1/2时，回到当前页
			if(Math.abs(disX)<translateX/2){
				wrap.style.transition = '0.5s';
				transformCss(wrap,'translateX',-translateX);
			}	
		})
		}
	}	
	
	//事件委派实现点击变色
	function changeColor(){
		var navText = document.getElementById('navText');
		var lis = document.querySelectorAll('#navText li');
		
		//navText的touchmove事件
		navText.addEventListener('touchmove',function(){
			//ev.target 为目标元素动态添加classname，防止误触
			if(!this.ismove){
				this.ismove = true;
				}
		})
		
		//navText的touchend事件
		navText.addEventListener('touchend',function(ev){
			var touch = ev.changedTouches[0];
			if(!this.ismove){
				//清除li上的原有样式
				for(var i=0;i<lis.length;i++){
					lis[i].className='';			
				};
				//判断touch.target.nodeName获取的是a还是li元素
				//如果是a则对其父节点添加class属性，如果是li则对其自身添加
				if(touch.target.nodeName =='A'){
					touch.target.parentNode.className = 'active'; 
				}else if(touch.target.nodeName =='LI'){
					touch.target.className = 'active';
				}	
			}
			//重置ismove
			this.ismove = false;
		})	
	}
	
	//导航实现滑屏效果
	function drag(){
		var navList = document.getElementById('navList');
		var navText = document.getElementById('navText');
		//3d变换处理文字闪的效果
		transformCss(navText,'translateZ',0.01);
		//定义元素位置和初始结束时间
		var nowP = 0;
		var nowT = 0;
		var lastP = 0;
		var lastT = 0;
		var disP = 0;
		var disT = 0;
		
		//元素的touchstart事件
		navList.addEventListener('touchstart',function(ev){
			var touch = ev.changedTouches[0];
			navList.style.transition = 'none';
			
			startX = touch.clientX;
			eleX = transformCss(navList,'translateX');
			lastP = eleX;
			lastT = new Date().getTime();
		})
		
		//元素的touchmove事件
		navList.addEventListener('touchmove',function(ev){
			var touch = ev.changedTouches[0];
			var nowX = touch.clientX;
			var disX = nowX - startX;
			var translateX = eleX + disX;
			var scale = 0;
			//临界值
			var minWidth = document.documentElement.clientWidth - navText.offsetWidth;
			if(translateX > 0){
				//模拟拉力系数
				scale = 0.8 - translateX/document.documentElement.clientWidth;
				translateX = translateX * scale;
			}else if(translateX < minWidth){
				var over = minWidth - translateX;//负值
				scale = 0.8 - over/document.documentElement.clientWidth;
				translateX = minWidth - (over * scale);
			}
			transformCss(navList,'translateX',translateX);
			nowP = translateX;
			nowT = new Date().getTime();
			disP = nowP - lastP;
			disT = nowT - lastT;
		})	
		
		//元素的touchend事件
		navList.addEventListener('touchend',function(ev){
			var touch = ev.changedTouches[0];
			var speed = disP/disT;
			var target = transformCss(navList,'translateX') + speed*100; 
			var minWidth = document.documentElement.clientWidth - navText.offsetWidth;
			//回弹效果cubic-bezier
			var bezier = "";
			//位置限定
			if(target>0){
				target = 0;
				bezier = 'cubic-bezier(.03,1.58,.73,1.5)';
			}else if(target < minWidth ){
				target = minWidth;
				bezier = 'cubic-bezier(.03,1.58,.73,1.5)';
			};
			navList.style.transition = '0.5s ' + bezier;
			transformCss(navList,'translateX',target);
		})
	}
	
	//通过js动态获取焦点
	function changeFocus(){
		var inputN = document.querySelector('#search input[type=text]');
		inputN.addEventListener('touchstart',function(ev){
			this.focus();
			//取消冒泡，为了防止冒泡到document，触发其touchstart事件，使input失去焦点
			ev.stopPropagation();
		})
		document.addEventListener('touchstart',function(){
			inputN.blur();
		})
	}
	 
	 //菜单按钮变换
	 function changeMenu(){
	 	var maskN = document.getElementById('mask');
	 	var menuBtn = document.getElementById('menuBtn');
	 	
	 	//按钮的touchstart事件
	 	menuBtn.addEventListener('touchstart',function(ev){
	 		//判断其classname属性，动态改变其值，并设置遮罩层的显示与隐藏
	 		if(menuBtn.className == 'menuBtnClos'){
	 			menuBtn.className = 'menuBtnOpen';
	 			mask.style.display ='block';
	 		}else if(menuBtn.className == 'menuBtnOpen'){
	 			menuBtn.className = 'menuBtnClos';
	 			mask.style.display ='none';
	 		}
	 		//取消冒泡，防止点击到document时触发其touchstart事件
	 		ev.stopPropagation();
	 	})
	 	
	 	//document的touchstart事件
	 	document.addEventListener('touchstart',function(){
	 		if(menuBtn.className == 'menuBtnOpen'){
	 			menuBtn.className = 'menuBtnClos';
	 			mask.style.display ='none';
	 		}
	 	})
	 	
	 	//mask的touchstart事件
	 	//取消遮罩层的冒泡，使其touchstart操作不会触发document的touchstart事件
	 	mask.addEventListener('touchstart',function(ev){
	 		ev.stopPropagation();
	 	})
	 }
	 
	 //轮播图
	 function changeImg(){
		  //动态获取list的宽度，wrap的高度，以及li的宽度百分比
		  var wrap = document.getElementById("pic_wrap");
		  var list = document.getElementById("pic_list");
		  list.innerHTML += list.innerHTML;
		  var liNodes = document.querySelectorAll("#pic_list li");
		  var spanNodes = document.querySelectorAll("#pic_nav span");
		  //布局元素，动态设置其样式
		  var styleN = document.createElement("style");
		  var cssText = "#pic_wrap{height: "+liNodes[0].offsetHeight+"px;}";
		  cssText += "#pic_list{width: "+liNodes.length+"00%;}";
		  cssText += "#pic_list li{width: "+100/liNodes.length+"%;}";
		  styleN.innerHTML = cssText;
		  document.head.appendChild(styleN);
		  //横向滑屏，定义list当前位置和手指当前位置
		  var eleX = 0;
		  var startX = 0;
		  //定义手指之间的距离（移动前后）
		  var disX = 0;
		  var translateX = 0;
		  var timer = 0;
		  var now = 0;
		  var startY = 0;
		  //防抖动
		  //判断用户手指第一次move
		  var isFirst = true;
		  //是否执行x方向上的逻辑
		  var isX = true;
		  
		  //为wrap绑定touchstart事件
		  wrap.addEventListener("touchstart",function(ev){
			  	list.style.transition = 'none';
			  	//置回，防抖
			  	isX = true;
			  	isFirst = true;
			  	//touchstart时，关定时器
		  		clearInterval(timer);
			  	//无缝滑屏
		  		var left = translateX;
		  		//判断当前的now值，四舍五入判断用户左滑还是右滑
			  	now = Math.round(-left/document.documentElement.clientWidth);
			  	//无缝滑屏操作
			  	//当第一张时，跳到第二组第一张
			  	//最后一张时，跳到第一组最后一张
			  	if(now == 0){
			  		now = spanNodes.length;
			  	}else if(now == liNodes.length-1){
			  		now = spanNodes.length-1;
			  	}
			  	translateX = -now*document.documentElement.clientWidth;
				//获取手指当前位置	
			  	var touch = ev.changedTouches[0];
			  	startX = touch.clientX;
			  	eleX = translateX;
			  	startY = touch.clientY;
		  })
		  
		  //为wrap绑定touchmove事件
		  wrap.addEventListener("touchmove",function(ev){
			  	var touch = ev.changedTouches[0];
			  	//防抖，看门狗
			  	if(!isX){
			  		return;
			  	};
			  	//手指当前位置
			  	var nowX = touch.clientX;
			  	disX = nowX - startX;
			  	translateX = eleX + disX;
			  	var nowY = touch.clientY;
			  	var disY = nowY - startY;
			  	//防抖动
			  	if(isFirst){
			  		isFirst = false;
			  		if(Math.abs(disY)>Math.abs(disX)){
			  			isX = false;
			  		};
			  	};
			  	//元素当前位置
			  	list.style.transform = 'translateX('+ translateX +'px)'
			})
		  
		    //为wrap绑定touchend事件
		    wrap.addEventListener("touchend",function(){
				var left = translateX;
				//获取元素的当前now值，注意是负值
			  	now = Math.round(-left/document.documentElement.clientWidth);
			  	//限定now范围
			  	if(now < 0){
			  		now = 0;
			  	}else if(now > list.length-1){
			  		now = list.length-1
			  	}
			  	list.style.transition = "0.5s";
			  	//注意负号，左滑now值增加，translateX为负
			  	translateX = -now * document.documentElement.clientWidth;
			  	list.style.transform = 'translateX('+ translateX +'px)';
			  	//同步小圆点
			  	for(var i=0;i<spanNodes.length;i++){
			  		spanNodes[i].className = "";
			  	}
			  	//注意spanNodes与liNodes的数值关系
			  	spanNodes[now%spanNodes.length].className = "active";
			  	//touchend后自动轮播
			  	auto();
	 	 });  
		 //自动轮播
	     auto();
	     
		  //自动轮播
		 function auto(){
		 	 //清除定时器
		 	 clearInterval(timer);
			 timer = setInterval(function(){
			 	//空白区域
			 	//自动轮播时，当图片加载到最后一张时直接跳转到第一组的最后一张
				if(now == liNodes.length-1){
					now = spanNodes.length-1;
				}
			 	list.style.transition = 'none'; 
			 	translateX = -now * document.documentElement.clientWidth;
		  		list.style.transform = 'translateX('+ translateX +'px)';
		  		//因为同时设置了list的transition属性，为不影响上一步操作，采取延时调用
		  		setTimeout(function(){
		  			now++;
			 		list.style.transition = '0.5s';
			 		translateX = -now * document.documentElement.clientWidth;
		  			list.style.transform = 'translateX('+ translateX +'px)';
			  		//同步小圆点
			  		for(var i=0;i<spanNodes.length;i++){
			  		spanNodes[i].className = "";
			  		}
			  		spanNodes[now%spanNodes.length].className = "active";
		  		},20)	
			 },2000)
	 	 }
	 }	   
</script>
</html>